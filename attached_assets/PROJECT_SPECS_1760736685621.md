# AI-Doctor: Acil Tıp Hasta Takip Sistemi
## Teknik Spesifikasyonlar ve Genel Bakış

### 🎯 Proje Özeti
AI-Doctor, acil tıp uzmanları için yapay zeka destekli hasta takip ve klinik karar destek sistemidir. Mobil-first yaklaşımla geliştirilecek bir SaaS platformudur.

### 📋 Teknoloji Stack

#### Backend
- **Framework**: Node.js + Express.js
- **Veritabanı**: PostgreSQL (Ana veri) + MongoDB (Doküman/Log)
- **ORM**: Prisma
- **Authentication**: JWT + bcrypt
- **API Style**: RESTful API
- **Real-time**: Socket.io (bildirimler için)
- **File Storage**: AWS S3 (görüntüler için)
- **AI Integration**: OpenAI API / Anthropic Claude API

#### Frontend (Mobil)
- **Framework**: React Native + Expo
- **State Management**: Redux Toolkit
- **Navigation**: React Navigation v6
- **UI Components**: React Native Paper + Custom Components
- **Forms**: React Hook Form
- **API Client**: Axios
- **Styling**: Styled Components / Tailwind (NativeWind)

#### DevOps
- **Version Control**: Git
- **Container**: Docker
- **CI/CD**: GitHub Actions
- **Hosting**: 
  - Backend: Render / Railway / AWS
  - Database: Render Postgres / Supabase
  - Mobile: Expo EAS

---

## 🏗️ Proje Yapısı

```
ai-doctor/
├── backend/
│   ├── src/
│   │   ├── config/          # Konfigürasyon dosyaları
│   │   ├── controllers/     # Route controller'ları
│   │   ├── middleware/      # Express middleware'ler
│   │   ├── models/          # Prisma modelleri
│   │   ├── routes/          # API route tanımları
│   │   ├── services/        # İş mantığı katmanı
│   │   ├── utils/           # Yardımcı fonksiyonlar
│   │   ├── validators/      # Input validasyon
│   │   └── app.js           # Express app setup
│   ├── prisma/
│   │   └── schema.prisma    # Database schema
│   ├── tests/               # Unit ve integration testler
│   ├── .env.example
│   ├── package.json
│   └── README.md
│
├── mobile/
│   ├── src/
│   │   ├── components/      # Reusable components
│   │   ├── screens/         # Ekran componentleri
│   │   ├── navigation/      # Navigation yapısı
│   │   ├── store/           # Redux store
│   │   ├── services/        # API çağrıları
│   │   ├── utils/           # Yardımcı fonksiyonlar
│   │   ├── constants/       # Sabitler
│   │   ├── hooks/           # Custom hooks
│   │   └── App.js           # Ana uygulama
│   ├── assets/              # Resimler, fontlar
│   ├── app.json             # Expo config
│   ├── package.json
│   └── README.md
│
└── docs/                    # Dokümantasyon
    ├── api/                 # API dökümantasyonu
    ├── architecture/        # Mimari diyagramlar
    └── guides/              # Geliştirme kılavuzları
```

---

## 📊 Veri Modeli (Ana Tablolar)

### User (Doktor)
```
- id: UUID
- email: String (unique)
- password: String (hashed)
- name: String
- title: String
- specialty: String
- phone: String
- isVerified: Boolean
- subscriptionType: Enum (free, premium, enterprise)
- subscriptionEndDate: DateTime
- createdAt: DateTime
- updatedAt: DateTime
```

### Patient
```
- id: UUID
- userId: UUID (foreign key -> User)
- name: String
- age: Integer
- gender: Enum (male, female, other)
- identityNumber: String (optional, encrypted)
- phone: String
- admissionTime: DateTime
- complaint: Text
- status: Enum (evaluation, lab-waiting, consultation, ready, discharged)
- priority: Enum (low, medium, high, critical)
- isActive: Boolean
- dischargeTime: DateTime (nullable)
- createdAt: DateTime
- updatedAt: DateTime
```

### VitalSigns
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- bloodPressureSystolic: Integer
- bloodPressureDiastolic: Integer
- heartRate: Integer
- temperature: Float
- oxygenSaturation: Integer
- respiratoryRate: Integer
- consciousness: String
- recordedAt: DateTime
- createdAt: DateTime
```

### MedicalHistory
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- complaintHistory: Text
- medicalHistory: Text (geçmiş hastalıklar)
- surgicalHistory: Text
- familyHistory: Text
- allergies: Text
- currentMedications: JSON
- smoking: Boolean
- alcohol: Boolean
- createdAt: DateTime
- updatedAt: DateTime
```

### LabResult
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- testName: String
- testType: Enum (blood, urine, other)
- results: JSON
- status: Enum (pending, completed, reviewed)
- orderedAt: DateTime
- resultedAt: DateTime (nullable)
- notes: Text
- createdAt: DateTime
```

### ImagingResult
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- imagingType: Enum (xray, ct, mri, ultrasound, other)
- bodyPart: String
- findings: Text
- imageUrl: String (S3 URL)
- status: Enum (pending, completed, reviewed)
- orderedAt: DateTime
- completedAt: DateTime (nullable)
- createdAt: DateTime
```

### AIAnalysis
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- analysisType: Enum (diagnosis, treatment, test-recommendation)
- inputData: JSON (hasta verileri snapshot)
- outputData: JSON (AI çıktısı)
- confidence: Float
- references: JSON (akademik referanslar)
- createdAt: DateTime
```

### PatientNote
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- userId: UUID (foreign key -> User)
- noteType: Enum (observation, progress, consultation-request, consultation-response)
- content: Text
- createdAt: DateTime
```

### ChatMessage
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- userId: UUID (foreign key -> User)
- role: Enum (user, assistant)
- content: Text
- metadata: JSON (AI modeli bilgisi, token kullanımı vb)
- createdAt: DateTime
```

### Notification
```
- id: UUID
- userId: UUID (foreign key -> User)
- patientId: UUID (foreign key -> Patient, nullable)
- type: Enum (lab-result, reminder, critical-value, system)
- title: String
- message: Text
- isRead: Boolean
- scheduledFor: DateTime (nullable, zamanlı bildirimler için)
- createdAt: DateTime
```

---

## 🔐 Authentication Flow

1. **Kayıt (Register)**
   - POST /api/auth/register
   - Email, şifre, doktor bilgileri
   - Email doğrulama linki gönder
   - Free tier ile başla (3 hasta limiti)

2. **Giriş (Login)**
   - POST /api/auth/login
   - Email + şifre
   - JWT token döndür (access + refresh token)

3. **Token Yenileme**
   - POST /api/auth/refresh
   - Refresh token ile yeni access token al

4. **Şifre Sıfırlama**
   - POST /api/auth/forgot-password
   - POST /api/auth/reset-password

---

## 🛣️ API Endpoints (Ana Rotalar)

### Authentication
```
POST   /api/auth/register
POST   /api/auth/login
POST   /api/auth/refresh
POST   /api/auth/logout
POST   /api/auth/forgot-password
POST   /api/auth/reset-password
GET    /api/auth/verify-email/:token
```

### User Profile
```
GET    /api/user/profile
PUT    /api/user/profile
PUT    /api/user/password
GET    /api/user/subscription
POST   /api/user/subscription/upgrade
```

### Patients
```
GET    /api/patients              # Kullanıcının tüm hastaları
POST   /api/patients              # Yeni hasta ekle
GET    /api/patients/:id          # Hasta detayları
PUT    /api/patients/:id          # Hasta güncelle
DELETE /api/patients/:id          # Hasta sil (soft delete)
PATCH  /api/patients/:id/status   # Hasta durumu güncelle
PATCH  /api/patients/:id/discharge # Hasta taburcu
```

### Vital Signs
```
GET    /api/patients/:id/vitals
POST   /api/patients/:id/vitals
GET    /api/patients/:id/vitals/:vitalId
PUT    /api/patients/:id/vitals/:vitalId
```

### Medical History
```
GET    /api/patients/:id/history
POST   /api/patients/:id/history
PUT    /api/patients/:id/history/:historyId
```

### Lab Results
```
GET    /api/patients/:id/labs
POST   /api/patients/:id/labs
GET    /api/patients/:id/labs/:labId
PUT    /api/patients/:id/labs/:labId
PATCH  /api/patients/:id/labs/:labId/status
```

### Imaging Results
```
GET    /api/patients/:id/imaging
POST   /api/patients/:id/imaging
GET    /api/patients/:id/imaging/:imagingId
PUT    /api/patients/:id/imaging/:imagingId
POST   /api/patients/:id/imaging/:imagingId/upload
```

### AI Analysis
```
POST   /api/ai/analyze              # Yeni AI analizi başlat
GET    /api/patients/:id/ai-analysis # Hasta için tüm AI analizleri
GET    /api/ai/analysis/:id         # Spesifik analiz detayı
POST   /api/ai/refresh/:patientId   # AI analizini yenile
```

### Chat (Patient-specific)
```
GET    /api/patients/:id/chat       # Chat geçmişi
POST   /api/patients/:id/chat       # Yeni mesaj gönder
DELETE /api/patients/:id/chat       # Chat geçmişini temizle
```

### Notes
```
GET    /api/patients/:id/notes
POST   /api/patients/:id/notes
PUT    /api/patients/:id/notes/:noteId
DELETE /api/patients/:id/notes/:noteId
```

### Notifications
```
GET    /api/notifications
PATCH  /api/notifications/:id/read
DELETE /api/notifications/:id
POST   /api/notifications/settings
```

### Guidelines & Resources
```
GET    /api/guidelines              # Kılavuzlar listesi
GET    /api/guidelines/:id          # Spesifik kılavuz
GET    /api/algorithms              # Algoritma listesi
GET    /api/algorithms/:id          # Spesifik algoritma
POST   /api/calculators             # Dozaj hesaplama vb.
```

---

## 🤖 AI Integration Yaklaşımı

### 1. AI Analiz Servisi
```javascript
// services/aiService.js
async function analyzePatient(patientData) {
  // 1. Hasta verilerini hazırla (anamnez, vital, lab, imaging)
  // 2. Structured prompt oluştur
  // 3. OpenAI/Claude API çağrısı
  // 4. Response'u parse et ve yapılandır
  // 5. Akademik referansları ekle
  // 6. Veritabanına kaydet
  return aiAnalysis;
}
```

### 2. Chat Servisi
```javascript
// services/chatService.js
async function sendChatMessage(patientId, userMessage) {
  // 1. Hasta verilerini context olarak al
  // 2. Önceki chat geçmişini al
  // 3. System prompt + context + geçmiş + yeni mesaj
  // 4. AI'dan yanıt al
  // 5. Chat geçmişine kaydet
  return assistantReply;
}
```

### 3. AI Prompt Yapısı
```
System: Sen acil tıp uzmanı bir AI asistansın...

Context: 
- Hasta: [isim, yaş, cinsiyet]
- Şikayet: [şikayet]
- Vital Bulgular: [vital signs]
- Anamnez: [medical history]
- Lab Sonuçları: [lab results]
- Görüntüleme: [imaging results]

Task: Bu hasta için:
1. Diferansiyel tanı listesi (olasılık yüzdeleriyle)
2. Önerilen tetkikler (öncelik sırasıyla)
3. Tedavi yaklaşımı
4. Konsültasyon önerileri
5. Her öneri için akademik referans

Format: JSON
```

---

## 🔒 Güvenlik Gereksinimleri

### 1. Authentication & Authorization
- JWT token kullanımı (access: 15 min, refresh: 7 days)
- Bcrypt ile şifre hashleme (salt rounds: 10)
- Rate limiting (login: 5 attempt/15min)
- CORS yapılandırması

### 2. Data Protection
- HTTPS zorunlu
- Hasta kimlik numaraları encrypt edilmeli
- Hassas veriler için field-level encryption
- SQL injection koruması (Prisma ORM)
- XSS koruması (input sanitization)

### 3. KVKK Compliance
- Açık rıza metinleri
- Veri saklama süreleri (max 6 ay inaktif hastalar için)
- Silme/anonim hale getirme fonksiyonları
- Audit log (who, what, when)

---

## 📱 Mobil Uygulama Yapısı

### Ekranlar (Navigation Flow)
```
Auth Stack
├── LoginScreen
├── RegisterScreen
├── ForgotPasswordScreen
└── EmailVerificationScreen

Main Stack (Tab Navigator)
├── Home Tab
│   ├── PatientListScreen
│   └── PatientDetailScreen
│       ├── SummaryTab
│       ├── AnamnesisTab
│       ├── TestsTab
│       ├── AITab
│       └── ChatTab
├── Statistics Tab
│   └── StatisticsScreen
├── Guidelines Tab
│   ├── GuidelinesScreen
│   └── GuidelineDetailScreen
└── Profile Tab
    ├── ProfileScreen
    ├── SubscriptionScreen
    └── SettingsScreen
```

### State Management (Redux)
```
store/
├── slices/
│   ├── authSlice.js         # User authentication state
│   ├── patientSlice.js      # Patient list & selected patient
│   ├── vitalsSlice.js       # Vital signs
│   ├── labsSlice.js         # Lab results
│   ├── imagingSlice.js      # Imaging results
│   ├── aiSlice.js           # AI analysis
│   ├── chatSlice.js         # Chat messages
│   ├── notificationSlice.js # Notifications
│   └── uiSlice.js           # UI state (loading, modals)
└── store.js                 # Redux store configuration
```

---

## 🧪 Test Stratejisi

### Backend
- Unit tests (Jest)
- Integration tests (Supertest)
- API endpoint tests
- Database tests

### Frontend
- Component tests (Jest + React Testing Library)
- E2E tests (Detox - optional)
- Snapshot tests

### Test Coverage Target
- Backend: 80%+
- Frontend: 70%+

---

## 📈 Performance Hedefleri

- API Response Time: < 500ms (average)
- Mobile App Launch: < 3 seconds
- Database Queries: < 100ms (optimized indexes)
- Image Upload: < 5 seconds (compressed)
- AI Analysis: < 10 seconds

---

## 🚀 Deployment Stratejisi

### Development
- Local development (docker-compose)
- Hot reload enabled
- Dev database

### Staging
- Render/Railway staging environment
- Test database
- Pre-production testing

### Production
- Render/Railway production
- PostgreSQL production database
- CDN for static assets
- Error tracking (Sentry)
- Analytics (Mixpanel/Amplitude)

---

## 📝 Geliştirme Sırası

Bu proje **10 aşamada** geliştirilecek:

1. ✅ Proje altyapısı ve setup
2. ✅ Backend temel yapı + Auth
3. ✅ Database modelleri ve migrations
4. ✅ Hasta CRUD API endpoints
5. ✅ Vital signs & Medical history API
6. ✅ Frontend temel yapı + Navigation
7. ✅ Auth ekranları + API entegrasyonu
8. ✅ Hasta listesi ekranı
9. ✅ Hasta detay ekranları (tüm tablar)
10. ✅ AI entegrasyonu + Chat

Her aşama **bağımsız test edilebilir** olmalıdır.

---

## 🔧 Environment Variables

### Backend (.env)
```
NODE_ENV=development
PORT=5000
DATABASE_URL=postgresql://user:pass@localhost:5432/aidoctor
JWT_SECRET=your-super-secret-key-here
JWT_REFRESH_SECRET=your-refresh-secret-key-here
OPENAI_API_KEY=sk-...
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_BUCKET=aidoctor-images
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=noreply@aidoctor.com
SMTP_PASS=...
```

### Mobile (app.config.js)
```
API_BASE_URL=http://localhost:5000/api
WS_URL=ws://localhost:5000
SENTRY_DSN=...
MIXPANEL_TOKEN=...
```

---

## 📚 Önemli Notlar

1. **Freemium Model**: Free tier 3 hasta limiti, premium unlimited
2. **Offline Support**: Critical features offline çalışmalı (hasta listesi, vital signs)
3. **Real-time Updates**: Socket.io ile lab sonuçları, bildirimler
4. **Image Optimization**: Mobilde upload öncesi compress (max 2MB)
5. **Error Handling**: Tüm API hataları user-friendly mesajlarla
6. **Loading States**: Her async işlemde loading indicator
7. **Form Validation**: Yup schema validation
8. **Accessibility**: Screen reader support, contrast ratios
9. **Internationalization**: i18n hazırlığı (şimdilik Türkçe)
10. **Documentation**: Her fonksiyon JSDoc ile dokümante

---

## 🆘 Yardım ve Kaynaklar

- **React Native Docs**: https://reactnative.dev/docs
- **Expo Docs**: https://docs.expo.dev/
- **Prisma Docs**: https://www.prisma.io/docs
- **Express Docs**: https://expressjs.com/
- **OpenAI API**: https://platform.openai.com/docs

---

Bu dokümanda tüm teknik detaylar yer alıyor. Her aşamada bu dosyaya referans vereceğiz.
