# AI-Doctor: Acil TÄ±p Hasta Takip Sistemi
## Teknik Spesifikasyonlar ve Genel BakÄ±ÅŸ

### ğŸ¯ Proje Ã–zeti
AI-Doctor, acil tÄ±p uzmanlarÄ± iÃ§in yapay zeka destekli hasta takip ve klinik karar destek sistemidir. Mobil-first yaklaÅŸÄ±mla geliÅŸtirilecek bir SaaS platformudur.

### ğŸ“‹ Teknoloji Stack

#### Backend
- **Framework**: Node.js + Express.js
- **VeritabanÄ±**: PostgreSQL (Ana veri) + MongoDB (DokÃ¼man/Log)
- **ORM**: Prisma
- **Authentication**: JWT + bcrypt
- **API Style**: RESTful API
- **Real-time**: Socket.io (bildirimler iÃ§in)
- **File Storage**: AWS S3 (gÃ¶rÃ¼ntÃ¼ler iÃ§in)
- **AI Integration**: OpenAI API / Anthropic Claude API

#### Frontend (Mobil)
- **Framework**: React Native + Expo
- **State Management**: Redux Toolkit
- **Navigation**: React Navigation v6
- **UI Components**: React Native Paper + Custom Components
- **Forms**: React Hook Form
- **API Client**: Axios
- **Styling**: Styled Components / Tailwind (NativeWind)

#### DevOps
- **Version Control**: Git
- **Container**: Docker
- **CI/CD**: GitHub Actions
- **Hosting**: 
  - Backend: Render / Railway / AWS
  - Database: Render Postgres / Supabase
  - Mobile: Expo EAS

---

## ğŸ—ï¸ Proje YapÄ±sÄ±

```
ai-doctor/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/          # KonfigÃ¼rasyon dosyalarÄ±
â”‚   â”‚   â”œâ”€â”€ controllers/     # Route controller'larÄ±
â”‚   â”‚   â”œâ”€â”€ middleware/      # Express middleware'ler
â”‚   â”‚   â”œâ”€â”€ models/          # Prisma modelleri
â”‚   â”‚   â”œâ”€â”€ routes/          # API route tanÄ±mlarÄ±
â”‚   â”‚   â”œâ”€â”€ services/        # Ä°ÅŸ mantÄ±ÄŸÄ± katmanÄ±
â”‚   â”‚   â”œâ”€â”€ utils/           # YardÄ±mcÄ± fonksiyonlar
â”‚   â”‚   â”œâ”€â”€ validators/      # Input validasyon
â”‚   â”‚   â””â”€â”€ app.js           # Express app setup
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma    # Database schema
â”‚   â”œâ”€â”€ tests/               # Unit ve integration testler
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ mobile/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # Reusable components
â”‚   â”‚   â”œâ”€â”€ screens/         # Ekran componentleri
â”‚   â”‚   â”œâ”€â”€ navigation/      # Navigation yapÄ±sÄ±
â”‚   â”‚   â”œâ”€â”€ store/           # Redux store
â”‚   â”‚   â”œâ”€â”€ services/        # API Ã§aÄŸrÄ±larÄ±
â”‚   â”‚   â”œâ”€â”€ utils/           # YardÄ±mcÄ± fonksiyonlar
â”‚   â”‚   â”œâ”€â”€ constants/       # Sabitler
â”‚   â”‚   â”œâ”€â”€ hooks/           # Custom hooks
â”‚   â”‚   â””â”€â”€ App.js           # Ana uygulama
â”‚   â”œâ”€â”€ assets/              # Resimler, fontlar
â”‚   â”œâ”€â”€ app.json             # Expo config
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â”‚
â””â”€â”€ docs/                    # DokÃ¼mantasyon
    â”œâ”€â”€ api/                 # API dÃ¶kÃ¼mantasyonu
    â”œâ”€â”€ architecture/        # Mimari diyagramlar
    â””â”€â”€ guides/              # GeliÅŸtirme kÄ±lavuzlarÄ±
```

---

## ğŸ“Š Veri Modeli (Ana Tablolar)

### User (Doktor)
```
- id: UUID
- email: String (unique)
- password: String (hashed)
- name: String
- title: String
- specialty: String
- phone: String
- isVerified: Boolean
- subscriptionType: Enum (free, premium, enterprise)
- subscriptionEndDate: DateTime
- createdAt: DateTime
- updatedAt: DateTime
```

### Patient
```
- id: UUID
- userId: UUID (foreign key -> User)
- name: String
- age: Integer
- gender: Enum (male, female, other)
- identityNumber: String (optional, encrypted)
- phone: String
- admissionTime: DateTime
- complaint: Text
- status: Enum (evaluation, lab-waiting, consultation, ready, discharged)
- priority: Enum (low, medium, high, critical)
- isActive: Boolean
- dischargeTime: DateTime (nullable)
- createdAt: DateTime
- updatedAt: DateTime
```

### VitalSigns
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- bloodPressureSystolic: Integer
- bloodPressureDiastolic: Integer
- heartRate: Integer
- temperature: Float
- oxygenSaturation: Integer
- respiratoryRate: Integer
- consciousness: String
- recordedAt: DateTime
- createdAt: DateTime
```

### MedicalHistory
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- complaintHistory: Text
- medicalHistory: Text (geÃ§miÅŸ hastalÄ±klar)
- surgicalHistory: Text
- familyHistory: Text
- allergies: Text
- currentMedications: JSON
- smoking: Boolean
- alcohol: Boolean
- createdAt: DateTime
- updatedAt: DateTime
```

### LabResult
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- testName: String
- testType: Enum (blood, urine, other)
- results: JSON
- status: Enum (pending, completed, reviewed)
- orderedAt: DateTime
- resultedAt: DateTime (nullable)
- notes: Text
- createdAt: DateTime
```

### ImagingResult
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- imagingType: Enum (xray, ct, mri, ultrasound, other)
- bodyPart: String
- findings: Text
- imageUrl: String (S3 URL)
- status: Enum (pending, completed, reviewed)
- orderedAt: DateTime
- completedAt: DateTime (nullable)
- createdAt: DateTime
```

### AIAnalysis
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- analysisType: Enum (diagnosis, treatment, test-recommendation)
- inputData: JSON (hasta verileri snapshot)
- outputData: JSON (AI Ã§Ä±ktÄ±sÄ±)
- confidence: Float
- references: JSON (akademik referanslar)
- createdAt: DateTime
```

### PatientNote
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- userId: UUID (foreign key -> User)
- noteType: Enum (observation, progress, consultation-request, consultation-response)
- content: Text
- createdAt: DateTime
```

### ChatMessage
```
- id: UUID
- patientId: UUID (foreign key -> Patient)
- userId: UUID (foreign key -> User)
- role: Enum (user, assistant)
- content: Text
- metadata: JSON (AI modeli bilgisi, token kullanÄ±mÄ± vb)
- createdAt: DateTime
```

### Notification
```
- id: UUID
- userId: UUID (foreign key -> User)
- patientId: UUID (foreign key -> Patient, nullable)
- type: Enum (lab-result, reminder, critical-value, system)
- title: String
- message: Text
- isRead: Boolean
- scheduledFor: DateTime (nullable, zamanlÄ± bildirimler iÃ§in)
- createdAt: DateTime
```

---

## ğŸ” Authentication Flow

1. **KayÄ±t (Register)**
   - POST /api/auth/register
   - Email, ÅŸifre, doktor bilgileri
   - Email doÄŸrulama linki gÃ¶nder
   - Free tier ile baÅŸla (3 hasta limiti)

2. **GiriÅŸ (Login)**
   - POST /api/auth/login
   - Email + ÅŸifre
   - JWT token dÃ¶ndÃ¼r (access + refresh token)

3. **Token Yenileme**
   - POST /api/auth/refresh
   - Refresh token ile yeni access token al

4. **Åifre SÄ±fÄ±rlama**
   - POST /api/auth/forgot-password
   - POST /api/auth/reset-password

---

## ğŸ›£ï¸ API Endpoints (Ana Rotalar)

### Authentication
```
POST   /api/auth/register
POST   /api/auth/login
POST   /api/auth/refresh
POST   /api/auth/logout
POST   /api/auth/forgot-password
POST   /api/auth/reset-password
GET    /api/auth/verify-email/:token
```

### User Profile
```
GET    /api/user/profile
PUT    /api/user/profile
PUT    /api/user/password
GET    /api/user/subscription
POST   /api/user/subscription/upgrade
```

### Patients
```
GET    /api/patients              # KullanÄ±cÄ±nÄ±n tÃ¼m hastalarÄ±
POST   /api/patients              # Yeni hasta ekle
GET    /api/patients/:id          # Hasta detaylarÄ±
PUT    /api/patients/:id          # Hasta gÃ¼ncelle
DELETE /api/patients/:id          # Hasta sil (soft delete)
PATCH  /api/patients/:id/status   # Hasta durumu gÃ¼ncelle
PATCH  /api/patients/:id/discharge # Hasta taburcu
```

### Vital Signs
```
GET    /api/patients/:id/vitals
POST   /api/patients/:id/vitals
GET    /api/patients/:id/vitals/:vitalId
PUT    /api/patients/:id/vitals/:vitalId
```

### Medical History
```
GET    /api/patients/:id/history
POST   /api/patients/:id/history
PUT    /api/patients/:id/history/:historyId
```

### Lab Results
```
GET    /api/patients/:id/labs
POST   /api/patients/:id/labs
GET    /api/patients/:id/labs/:labId
PUT    /api/patients/:id/labs/:labId
PATCH  /api/patients/:id/labs/:labId/status
```

### Imaging Results
```
GET    /api/patients/:id/imaging
POST   /api/patients/:id/imaging
GET    /api/patients/:id/imaging/:imagingId
PUT    /api/patients/:id/imaging/:imagingId
POST   /api/patients/:id/imaging/:imagingId/upload
```

### AI Analysis
```
POST   /api/ai/analyze              # Yeni AI analizi baÅŸlat
GET    /api/patients/:id/ai-analysis # Hasta iÃ§in tÃ¼m AI analizleri
GET    /api/ai/analysis/:id         # Spesifik analiz detayÄ±
POST   /api/ai/refresh/:patientId   # AI analizini yenile
```

### Chat (Patient-specific)
```
GET    /api/patients/:id/chat       # Chat geÃ§miÅŸi
POST   /api/patients/:id/chat       # Yeni mesaj gÃ¶nder
DELETE /api/patients/:id/chat       # Chat geÃ§miÅŸini temizle
```

### Notes
```
GET    /api/patients/:id/notes
POST   /api/patients/:id/notes
PUT    /api/patients/:id/notes/:noteId
DELETE /api/patients/:id/notes/:noteId
```

### Notifications
```
GET    /api/notifications
PATCH  /api/notifications/:id/read
DELETE /api/notifications/:id
POST   /api/notifications/settings
```

### Guidelines & Resources
```
GET    /api/guidelines              # KÄ±lavuzlar listesi
GET    /api/guidelines/:id          # Spesifik kÄ±lavuz
GET    /api/algorithms              # Algoritma listesi
GET    /api/algorithms/:id          # Spesifik algoritma
POST   /api/calculators             # Dozaj hesaplama vb.
```

---

## ğŸ¤– AI Integration YaklaÅŸÄ±mÄ±

### 1. AI Analiz Servisi
```javascript
// services/aiService.js
async function analyzePatient(patientData) {
  // 1. Hasta verilerini hazÄ±rla (anamnez, vital, lab, imaging)
  // 2. Structured prompt oluÅŸtur
  // 3. OpenAI/Claude API Ã§aÄŸrÄ±sÄ±
  // 4. Response'u parse et ve yapÄ±landÄ±r
  // 5. Akademik referanslarÄ± ekle
  // 6. VeritabanÄ±na kaydet
  return aiAnalysis;
}
```

### 2. Chat Servisi
```javascript
// services/chatService.js
async function sendChatMessage(patientId, userMessage) {
  // 1. Hasta verilerini context olarak al
  // 2. Ã–nceki chat geÃ§miÅŸini al
  // 3. System prompt + context + geÃ§miÅŸ + yeni mesaj
  // 4. AI'dan yanÄ±t al
  // 5. Chat geÃ§miÅŸine kaydet
  return assistantReply;
}
```

### 3. AI Prompt YapÄ±sÄ±
```
System: Sen acil tÄ±p uzmanÄ± bir AI asistansÄ±n...

Context: 
- Hasta: [isim, yaÅŸ, cinsiyet]
- Åikayet: [ÅŸikayet]
- Vital Bulgular: [vital signs]
- Anamnez: [medical history]
- Lab SonuÃ§larÄ±: [lab results]
- GÃ¶rÃ¼ntÃ¼leme: [imaging results]

Task: Bu hasta iÃ§in:
1. Diferansiyel tanÄ± listesi (olasÄ±lÄ±k yÃ¼zdeleriyle)
2. Ã–nerilen tetkikler (Ã¶ncelik sÄ±rasÄ±yla)
3. Tedavi yaklaÅŸÄ±mÄ±
4. KonsÃ¼ltasyon Ã¶nerileri
5. Her Ã¶neri iÃ§in akademik referans

Format: JSON
```

---

## ğŸ”’ GÃ¼venlik Gereksinimleri

### 1. Authentication & Authorization
- JWT token kullanÄ±mÄ± (access: 15 min, refresh: 7 days)
- Bcrypt ile ÅŸifre hashleme (salt rounds: 10)
- Rate limiting (login: 5 attempt/15min)
- CORS yapÄ±landÄ±rmasÄ±

### 2. Data Protection
- HTTPS zorunlu
- Hasta kimlik numaralarÄ± encrypt edilmeli
- Hassas veriler iÃ§in field-level encryption
- SQL injection korumasÄ± (Prisma ORM)
- XSS korumasÄ± (input sanitization)

### 3. KVKK Compliance
- AÃ§Ä±k rÄ±za metinleri
- Veri saklama sÃ¼releri (max 6 ay inaktif hastalar iÃ§in)
- Silme/anonim hale getirme fonksiyonlarÄ±
- Audit log (who, what, when)

---

## ğŸ“± Mobil Uygulama YapÄ±sÄ±

### Ekranlar (Navigation Flow)
```
Auth Stack
â”œâ”€â”€ LoginScreen
â”œâ”€â”€ RegisterScreen
â”œâ”€â”€ ForgotPasswordScreen
â””â”€â”€ EmailVerificationScreen

Main Stack (Tab Navigator)
â”œâ”€â”€ Home Tab
â”‚   â”œâ”€â”€ PatientListScreen
â”‚   â””â”€â”€ PatientDetailScreen
â”‚       â”œâ”€â”€ SummaryTab
â”‚       â”œâ”€â”€ AnamnesisTab
â”‚       â”œâ”€â”€ TestsTab
â”‚       â”œâ”€â”€ AITab
â”‚       â””â”€â”€ ChatTab
â”œâ”€â”€ Statistics Tab
â”‚   â””â”€â”€ StatisticsScreen
â”œâ”€â”€ Guidelines Tab
â”‚   â”œâ”€â”€ GuidelinesScreen
â”‚   â””â”€â”€ GuidelineDetailScreen
â””â”€â”€ Profile Tab
    â”œâ”€â”€ ProfileScreen
    â”œâ”€â”€ SubscriptionScreen
    â””â”€â”€ SettingsScreen
```

### State Management (Redux)
```
store/
â”œâ”€â”€ slices/
â”‚   â”œâ”€â”€ authSlice.js         # User authentication state
â”‚   â”œâ”€â”€ patientSlice.js      # Patient list & selected patient
â”‚   â”œâ”€â”€ vitalsSlice.js       # Vital signs
â”‚   â”œâ”€â”€ labsSlice.js         # Lab results
â”‚   â”œâ”€â”€ imagingSlice.js      # Imaging results
â”‚   â”œâ”€â”€ aiSlice.js           # AI analysis
â”‚   â”œâ”€â”€ chatSlice.js         # Chat messages
â”‚   â”œâ”€â”€ notificationSlice.js # Notifications
â”‚   â””â”€â”€ uiSlice.js           # UI state (loading, modals)
â””â”€â”€ store.js                 # Redux store configuration
```

---

## ğŸ§ª Test Stratejisi

### Backend
- Unit tests (Jest)
- Integration tests (Supertest)
- API endpoint tests
- Database tests

### Frontend
- Component tests (Jest + React Testing Library)
- E2E tests (Detox - optional)
- Snapshot tests

### Test Coverage Target
- Backend: 80%+
- Frontend: 70%+

---

## ğŸ“ˆ Performance Hedefleri

- API Response Time: < 500ms (average)
- Mobile App Launch: < 3 seconds
- Database Queries: < 100ms (optimized indexes)
- Image Upload: < 5 seconds (compressed)
- AI Analysis: < 10 seconds

---

## ğŸš€ Deployment Stratejisi

### Development
- Local development (docker-compose)
- Hot reload enabled
- Dev database

### Staging
- Render/Railway staging environment
- Test database
- Pre-production testing

### Production
- Render/Railway production
- PostgreSQL production database
- CDN for static assets
- Error tracking (Sentry)
- Analytics (Mixpanel/Amplitude)

---

## ğŸ“ GeliÅŸtirme SÄ±rasÄ±

Bu proje **10 aÅŸamada** geliÅŸtirilecek:

1. âœ… Proje altyapÄ±sÄ± ve setup
2. âœ… Backend temel yapÄ± + Auth
3. âœ… Database modelleri ve migrations
4. âœ… Hasta CRUD API endpoints
5. âœ… Vital signs & Medical history API
6. âœ… Frontend temel yapÄ± + Navigation
7. âœ… Auth ekranlarÄ± + API entegrasyonu
8. âœ… Hasta listesi ekranÄ±
9. âœ… Hasta detay ekranlarÄ± (tÃ¼m tablar)
10. âœ… AI entegrasyonu + Chat

Her aÅŸama **baÄŸÄ±msÄ±z test edilebilir** olmalÄ±dÄ±r.

---

## ğŸ”§ Environment Variables

### Backend (.env)
```
NODE_ENV=development
PORT=5000
DATABASE_URL=postgresql://user:pass@localhost:5432/aidoctor
JWT_SECRET=your-super-secret-key-here
JWT_REFRESH_SECRET=your-refresh-secret-key-here
OPENAI_API_KEY=sk-...
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_BUCKET=aidoctor-images
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=noreply@aidoctor.com
SMTP_PASS=...
```

### Mobile (app.config.js)
```
API_BASE_URL=http://localhost:5000/api
WS_URL=ws://localhost:5000
SENTRY_DSN=...
MIXPANEL_TOKEN=...
```

---

## ğŸ“š Ã–nemli Notlar

1. **Freemium Model**: Free tier 3 hasta limiti, premium unlimited
2. **Offline Support**: Critical features offline Ã§alÄ±ÅŸmalÄ± (hasta listesi, vital signs)
3. **Real-time Updates**: Socket.io ile lab sonuÃ§larÄ±, bildirimler
4. **Image Optimization**: Mobilde upload Ã¶ncesi compress (max 2MB)
5. **Error Handling**: TÃ¼m API hatalarÄ± user-friendly mesajlarla
6. **Loading States**: Her async iÅŸlemde loading indicator
7. **Form Validation**: Yup schema validation
8. **Accessibility**: Screen reader support, contrast ratios
9. **Internationalization**: i18n hazÄ±rlÄ±ÄŸÄ± (ÅŸimdilik TÃ¼rkÃ§e)
10. **Documentation**: Her fonksiyon JSDoc ile dokÃ¼mante

---

## ğŸ†˜ YardÄ±m ve Kaynaklar

- **React Native Docs**: https://reactnative.dev/docs
- **Expo Docs**: https://docs.expo.dev/
- **Prisma Docs**: https://www.prisma.io/docs
- **Express Docs**: https://expressjs.com/
- **OpenAI API**: https://platform.openai.com/docs

---

Bu dokÃ¼manda tÃ¼m teknik detaylar yer alÄ±yor. Her aÅŸamada bu dosyaya referans vereceÄŸiz.
