# PROMPT 1: Proje Altyapısı ve Initial Setup

## 🎯 Amaç
Bu aşamada AI-Doctor projesinin temel altyapısını kuracağız. Backend ve mobil uygulama için klasör yapıları oluşturacağız ve gerekli bağımlılıkları yükleyeceğiz.

## 📋 Yapılacaklar

### 1. Backend Projesi Kurulumu
```bash
# Ana proje klasörü oluştur
mkdir ai-doctor
cd ai-doctor

# Backend klasörü oluştur
mkdir backend
cd backend

# Node.js projesi başlat
npm init -y

# Bağımlılıkları yükle
npm install express cors dotenv bcryptjs jsonwebtoken
npm install @prisma/client
npm install --save-dev prisma nodemon

# Prisma'yı initialize et
npx prisma init
```

### 2. Backend Klasör Yapısı Oluştur
```
backend/
├── src/
│   ├── config/
│   │   ├── database.js
│   │   └── constants.js
│   ├── controllers/
│   ├── middleware/
│   │   ├── authMiddleware.js
│   │   └── errorMiddleware.js
│   ├── routes/
│   ├── services/
│   ├── utils/
│   │   ├── logger.js
│   │   └── response.js
│   └── app.js
├── prisma/
│   └── schema.prisma
├── tests/
├── .env.example
├── .gitignore
├── package.json
└── server.js
```

### 3. Backend package.json Scripts Ekle
```json
{
  "scripts": {
    "dev": "nodemon server.js",
    "start": "node server.js",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio",
    "test": "jest"
  }
}
```

### 4. .gitignore Dosyası Oluştur
```
node_modules/
.env
dist/
build/
*.log
.DS_Store
coverage/
```

### 5. .env.example Dosyası Oluştur
```
NODE_ENV=development
PORT=5000
DATABASE_URL=postgresql://user:password@localhost:5432/aidoctor
JWT_SECRET=your-super-secret-jwt-key-change-this
JWT_REFRESH_SECRET=your-refresh-secret-key-change-this
JWT_EXPIRE=15m
JWT_REFRESH_EXPIRE=7d
```

### 6. server.js (Entry Point) Oluştur
```javascript
require('dotenv').config();
const app = require('./src/app');

const PORT = process.env.PORT || 5000;

app.listen(PORT, () => {
  console.log(`🚀 Server running on port ${PORT}`);
  console.log(`📝 Environment: ${process.env.NODE_ENV}`);
});
```

### 7. src/app.js (Express App) Oluştur
```javascript
const express = require('express');
const cors = require('cors');
const errorMiddleware = require('./middleware/errorMiddleware');

const app = express();

// Middleware
app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'AI-Doctor API is running',
    timestamp: new Date().toISOString()
  });
});

// API Routes (şimdilik boş, sonraki aşamalarda eklenecek)
app.get('/api', (req, res) => {
  res.json({ message: 'AI-Doctor API v1.0' });
});

// Error handling middleware (en sonda olmalı)
app.use(errorMiddleware);

// 404 handler
app.use((req, res) => {
  res.status(404).json({ 
    success: false, 
    message: 'Endpoint not found' 
  });
});

module.exports = app;
```

### 8. Middleware Dosyalarını Oluştur

**src/middleware/errorMiddleware.js**
```javascript
const errorMiddleware = (err, req, res, next) => {
  console.error('Error:', err);

  const statusCode = err.statusCode || 500;
  const message = err.message || 'Internal Server Error';

  res.status(statusCode).json({
    success: false,
    message,
    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
  });
};

module.exports = errorMiddleware;
```

**src/middleware/authMiddleware.js** (boş template, sonra dolduracağız)
```javascript
const jwt = require('jsonwebtoken');

const protect = async (req, res, next) => {
  // Bu aşamada sadece template, Aşama 2'de dolduracağız
  next();
};

module.exports = { protect };
```

### 9. Utils Dosyalarını Oluştur

**src/utils/response.js**
```javascript
const successResponse = (res, statusCode, message, data = null) => {
  return res.status(statusCode).json({
    success: true,
    message,
    data
  });
};

const errorResponse = (res, statusCode, message, error = null) => {
  return res.status(statusCode).json({
    success: false,
    message,
    ...(process.env.NODE_ENV === 'development' && error && { error })
  });
};

module.exports = {
  successResponse,
  errorResponse
};
```

**src/utils/logger.js**
```javascript
const logger = {
  info: (message, meta = {}) => {
    console.log(`[INFO] ${new Date().toISOString()} - ${message}`, meta);
  },
  error: (message, meta = {}) => {
    console.error(`[ERROR] ${new Date().toISOString()} - ${message}`, meta);
  },
  warn: (message, meta = {}) => {
    console.warn(`[WARN] ${new Date().toISOString()} - ${message}`, meta);
  }
};

module.exports = logger;
```

### 10. src/config/constants.js Oluştur
```javascript
module.exports = {
  USER_ROLES: {
    DOCTOR: 'doctor',
    ADMIN: 'admin'
  },
  PATIENT_STATUS: {
    EVALUATION: 'evaluation',
    LAB_WAITING: 'lab-waiting',
    CONSULTATION: 'consultation',
    READY: 'ready',
    DISCHARGED: 'discharged'
  },
  PATIENT_PRIORITY: {
    LOW: 'low',
    MEDIUM: 'medium',
    HIGH: 'high',
    CRITICAL: 'critical'
  },
  SUBSCRIPTION_TYPES: {
    FREE: 'free',
    PREMIUM: 'premium',
    ENTERPRISE: 'enterprise'
  },
  FREE_PATIENT_LIMIT: 3
};
```

---

## ✅ Test Adımları

Bu aşamayı tamamladıktan sonra şunları test edin:

1. **Backend çalışıyor mu?**
```bash
cd backend
npm run dev
```

2. **Health check endpoint çalışıyor mu?**
```bash
# Yeni bir terminal açın
curl http://localhost:5000/health
```

Beklenen çıktı:
```json
{
  "status": "OK",
  "message": "AI-Doctor API is running",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

3. **API endpoint çalışıyor mu?**
```bash
curl http://localhost:5000/api
```

Beklenen çıktı:
```json
{
  "message": "AI-Doctor API v1.0"
}
```

---

## 📝 Tamamlanma Kriterleri

✅ Backend klasör yapısı oluşturuldu  
✅ Tüm bağımlılıklar yüklendi  
✅ server.js ve app.js dosyaları çalışıyor  
✅ Health check endpoint başarılı  
✅ Middleware'ler oluşturuldu  
✅ Utils fonksiyonları hazır  
✅ .env.example hazır  
✅ .gitignore ayarlandı  

---

## 🚀 Sonraki Adım

Bu aşama tamamlandığında **PROMPT 2: Authentication Sistemi** ile devam edeceğiz.

Şimdilik mobil uygulamayı bekletiyoruz, önce backend'i tamamlayacağız.

---

## ⚠️ Önemli Notlar

1. **Henüz Prisma schema oluşturmadık** - Bu Prompt 3'te olacak
2. **Henüz route'lar eklemedik** - Bu Prompt 2'de başlayacak
3. **.env dosyasını .gitignore'a eklemeyi unutmayın**
4. **PORT 5000 meşgulse başka port kullanabilirsiniz**

---

**Bu prompt tamamlandığında "Prompt 1 tamamlandı" diye cevap verin ve Prompt 2'ye geçin.**
