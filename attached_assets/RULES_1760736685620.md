# AI-Doctor Geliştirme Kuralları ve Best Practices

## 🚨 KRİTİK KURALLAR - ASLA İHLAL ETMEYİN

### 1. Kod Kalitesi
- ❌ **ASLA** `console.log` production kodunda bırakmayın
- ❌ **ASLA** hardcoded credentials/secrets kullanmayın
- ❌ **ASLA** senkron file operations kullanmayın (async/await kullanın)
- ✅ **HER ZAMAN** error handling yapın (try-catch)
- ✅ **HER ZAMAN** input validation yapın
- ✅ **HER ZAMAN** meaningful variable/function isimleri kullanın

### 2. Güvenlik
- ❌ **ASLA** şifreleri plain text saklamayın (bcrypt kullanın)
- ❌ **ASLA** SQL queries'i string concatenation ile yapmayın
- ❌ **ASLA** client'tan gelen veriyi direkt DB'ye yazmayın
- ✅ **HER ZAMAN** JWT token'ları validate edin
- ✅ **HER ZAMAN** rate limiting uygulayın
- ✅ **HER ZAMAN** HTTPS kullanın (production)
- ✅ **HER ZAMAN** CORS ayarlarını kontrol edin

### 3. Database
- ❌ **ASLA** sensitive data'yı encrypt etmeden saklamayın
- ❌ **ASLA** foreign key constraints'leri atlayın
- ❌ **ASLA** migration'ları manuel düzenlemeyin
- ✅ **HER ZAMAN** transactions kullanın (ilişkili işlemler için)
- ✅ **HER ZAMAN** indexes ekleyin (frequently queried fields)
- ✅ **HER ZAMAN** soft delete kullanın (hasta verileri için)

### 4. API Design
- ❌ **ASLA** sensitive data'yı response'da döndürmeyin (şifre hash vb.)
- ❌ **ASLA** generic error messages dışarı vermeyin (security)
- ✅ **HER ZAMAN** RESTful conventions'ı takip edin
- ✅ **HER ZAMAN** proper HTTP status codes kullanın
- ✅ **HER ZAMAN** response format'ı consistent tutun
- ✅ **HER ZAMAN** pagination implement edin (list endpoints)

### 5. React Native / Mobile
- ❌ **ASLA** inline styles yazmayın (StyleSheet kullanın)
- ❌ **ASLA** index number'ları key prop olarak kullanmayın
- ❌ **ASLA** memory leak'lere sebep olmayın (useEffect cleanup)
- ✅ **HER ZAMAN** loading states gösterin
- ✅ **HER ZAMAN** error boundaries kullanın
- ✅ **HER ZAMAN** optimized images kullanın
- ✅ **HER ZAMAN** keyboard avoiding view kullanın (forms)

---

## 📋 CODING STANDARDS

### JavaScript/Node.js

#### Naming Conventions
```javascript
// ✅ DOĞRU
const patientList = [];
function fetchPatientData() {}
class PatientService {}
const MAX_RETRY_COUNT = 3;

// ❌ YANLIŞ
const pl = [];
function fpd() {}
class patientservice {}
const maxretrycount = 3;
```

#### Function Structure
```javascript
// ✅ DOĞRU - Async/await kullanımı
async function createPatient(patientData) {
  try {
    // Validation
    if (!patientData.name) {
      throw new Error('Patient name is required');
    }
    
    // Business logic
    const patient = await db.patient.create({
      data: patientData
    });
    
    return { success: true, data: patient };
  } catch (error) {
    console.error('Error creating patient:', error);
    throw error; // Re-throw for controller to handle
  }
}

// ❌ YANLIŞ - Callback hell, error handling yok
function createPatient(patientData, callback) {
  db.patient.create(patientData, function(err, patient) {
    if (err) callback(err);
    callback(null, patient);
  });
}
```

#### Error Handling Pattern
```javascript
// ✅ DOĞRU - Consistent error response
const errorResponse = (res, statusCode, message, error = null) => {
  return res.status(statusCode).json({
    success: false,
    message,
    error: process.env.NODE_ENV === 'development' ? error : undefined
  });
};

// Controller usage
try {
  const result = await patientService.getPatient(id);
  return res.json({ success: true, data: result });
} catch (error) {
  return errorResponse(res, 500, 'Failed to fetch patient', error.message);
}
```

### React Native

#### Component Structure
```javascript
// ✅ DOĞRU - Functional component with hooks
import React, { useState, useEffect } from 'react';
import { View, Text, StyleSheet, ActivityIndicator } from 'react-native';

const PatientCard = ({ patient, onPress }) => {
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    // Cleanup function
    return () => {
      // Cleanup code here
    };
  }, []);
  
  if (loading) {
    return <ActivityIndicator />;
  }
  
  return (
    <View style={styles.container}>
      <Text style={styles.name}>{patient.name}</Text>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    padding: 16,
    backgroundColor: '#fff',
  },
  name: {
    fontSize: 18,
    fontWeight: 'bold',
  },
});

export default PatientCard;
```

#### Redux Pattern
```javascript
// ✅ DOĞRU - Redux Toolkit slice
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

export const fetchPatients = createAsyncThunk(
  'patients/fetchAll',
  async (_, { rejectWithValue }) => {
    try {
      const response = await api.get('/patients');
      return response.data;
    } catch (error) {
      return rejectWithValue(error.response.data);
    }
  }
);

const patientSlice = createSlice({
  name: 'patients',
  initialState: {
    list: [],
    loading: false,
    error: null,
  },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchPatients.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchPatients.fulfilled, (state, action) => {
        state.loading = false;
        state.list = action.payload;
      })
      .addCase(fetchPatients.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      });
  },
});

export default patientSlice.reducer;
```

---

## 🗂️ FILE ORGANIZATION

### Backend File Naming
```
✅ DOĞRU
controllers/patientController.js
services/patientService.js
models/Patient.js
routes/patientRoutes.js
middleware/authMiddleware.js
utils/dateHelper.js
validators/patientValidator.js

❌ YANLIŞ
controllers/patients.js
services/patient-service.js
models/patient.js
routes/Patients.js
```

### Frontend File Naming
```
✅ DOĞRU
screens/PatientListScreen.js
components/PatientCard.js
navigation/AppNavigator.js
services/apiService.js
constants/colors.js
hooks/usePatients.js

❌ YANLIŞ
screens/patientlist.js
components/patient-card.js
navigation/app-navigator.js
```

---

## 🔒 SECURITY CHECKLIST

### Her Endpoint İçin
- [ ] Authentication middleware var mı?
- [ ] Input validation yapılıyor mu?
- [ ] Rate limiting var mı?
- [ ] User authorization check ediliyor mu? (başkasının hastasına erişemiyor mu?)
- [ ] Sensitive data filter ediliyor mu?

### Her Form İçin
- [ ] Client-side validation var mı?
- [ ] Server-side validation var mı?
- [ ] XSS protection var mı?
- [ ] SQL injection korumalı mı?
- [ ] File upload size limit var mı?

---

## 📝 COMMIT MESSAGE CONVENTIONS

```
feat: Add patient list screen
fix: Fix authentication token expiry
refactor: Refactor patient service
docs: Update API documentation
style: Format code with prettier
test: Add patient controller tests
chore: Update dependencies
```

**Commit Structure:**
```
<type>: <subject>

<body> (optional)

<footer> (optional)
```

---

## 🧪 TESTING REQUIREMENTS

### Backend Test Örneği
```javascript
// tests/controllers/patientController.test.js
describe('Patient Controller', () => {
  describe('GET /api/patients', () => {
    it('should return patient list for authenticated user', async () => {
      const token = generateTestToken();
      const response = await request(app)
        .get('/api/patients')
        .set('Authorization', `Bearer ${token}`)
        .expect(200);
        
      expect(response.body.success).toBe(true);
      expect(Array.isArray(response.body.data)).toBe(true);
    });
    
    it('should return 401 for unauthenticated request', async () => {
      await request(app)
        .get('/api/patients')
        .expect(401);
    });
  });
});
```

### Frontend Test Örneği
```javascript
// __tests__/PatientCard.test.js
import { render, fireEvent } from '@testing-library/react-native';
import PatientCard from '../components/PatientCard';

describe('PatientCard', () => {
  const mockPatient = {
    id: '1',
    name: 'Test Patient',
    age: 30,
  };
  
  it('renders patient name correctly', () => {
    const { getByText } = render(<PatientCard patient={mockPatient} />);
    expect(getByText('Test Patient')).toBeTruthy();
  });
  
  it('calls onPress when pressed', () => {
    const onPressMock = jest.fn();
    const { getByText } = render(
      <PatientCard patient={mockPatient} onPress={onPressMock} />
    );
    
    fireEvent.press(getByText('Test Patient'));
    expect(onPressMock).toHaveBeenCalledWith(mockPatient);
  });
});
```

---

## 🚀 PERFORMANCE BEST PRACTICES

### Backend
```javascript
// ✅ DOĞRU - Eager loading ile N+1 problem'i çöz
const patients = await prisma.patient.findMany({
  where: { userId: userId },
  include: {
    vitalSigns: true,
    labResults: true,
  },
});

// ❌ YANLIŞ - N+1 query problem
const patients = await prisma.patient.findMany({ where: { userId } });
for (const patient of patients) {
  patient.vitals = await prisma.vitalSigns.findMany({ 
    where: { patientId: patient.id } 
  });
}
```

### Frontend
```javascript
// ✅ DOĞRU - FlatList for long lists
<FlatList
  data={patients}
  renderItem={({ item }) => <PatientCard patient={item} />}
  keyExtractor={(item) => item.id}
  removeClippedSubviews={true}
  maxToRenderPerBatch={10}
  windowSize={21}
/>

// ❌ YANLIŞ - ScrollView with map (poor performance)
<ScrollView>
  {patients.map(patient => (
    <PatientCard key={patient.id} patient={patient} />
  ))}
</ScrollView>

// ✅ DOĞRU - useMemo for expensive calculations
const sortedPatients = useMemo(() => {
  return patients.sort((a, b) => 
    new Date(b.admissionTime) - new Date(a.admissionTime)
  );
}, [patients]);

// ✅ DOĞRU - useCallback for function props
const handlePatientPress = useCallback((patient) => {
  navigation.navigate('PatientDetail', { patientId: patient.id });
}, [navigation]);
```

---

## 📱 RESPONSIVE DESIGN

```javascript
// ✅ DOĞRU - Dimensions API kullanımı
import { Dimensions } from 'react-native';

const { width, height } = Dimensions.get('window');

const styles = StyleSheet.create({
  container: {
    width: width * 0.9,
    padding: width > 768 ? 24 : 16, // Tablet vs phone
  },
});
```

---

## 🌐 API INTEGRATION PATTERN

```javascript
// services/apiService.js
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';

const api = axios.create({
  baseURL: process.env.API_BASE_URL,
  timeout: 10000,
});

// Request interceptor - Add auth token
api.interceptors.request.use(
  async (config) => {
    const token = await AsyncStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor - Handle errors
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Token expired, try refresh
      // If refresh fails, logout user
    }
    return Promise.reject(error);
  }
);

export default api;
```

---

## 🎨 UI/UX GUIDELINES

### Loading States
```javascript
// ✅ HER ZAMAN loading state göster
{loading ? (
  <ActivityIndicator size="large" color="#0000ff" />
) : (
  <PatientList data={patients} />
)}
```

### Error States
```javascript
// ✅ HER ZAMAN user-friendly error messages
{error && (
  <View style={styles.errorContainer}>
    <Text style={styles.errorText}>
      {error.message || 'Bir hata oluştu. Lütfen tekrar deneyin.'}
    </Text>
    <Button title="Tekrar Dene" onPress={handleRetry} />
  </View>
)}
```

### Empty States
```javascript
// ✅ HER ZAMAN empty state göster
{patients.length === 0 && !loading && (
  <View style={styles.emptyContainer}>
    <Text style={styles.emptyText}>Henüz hasta eklenmemiş</Text>
    <Button title="İlk Hastayı Ekle" onPress={handleAddPatient} />
  </View>
)}
```

---

## 🔍 DEBUGGING TIPS

### Backend
```javascript
// Development ortamında detaylı log
if (process.env.NODE_ENV === 'development') {
  console.log('Request Body:', req.body);
  console.log('User ID:', req.user.id);
}

// Production'da structured logging
logger.info('Patient created', {
  userId: req.user.id,
  patientId: patient.id,
  timestamp: new Date().toISOString(),
});
```

### Frontend
```javascript
// React Native Debugger kullan
// console.log yerine alert veya Toast kullan (görsel debug)
```

---

## ✅ PRE-COMMIT CHECKLIST

Her commit öncesi kontrol edin:
- [ ] Kod çalışıyor mu? (test ettim)
- [ ] Testler geçiyor mu?
- [ ] Console.log'lar temizlendi mi?
- [ ] Error handling var mı?
- [ ] Hardcoded value yok mu?
- [ ] Comments gereksizleri temizlendi mi?
- [ ] Naming conventions doğru mu?
- [ ] Security checklist tamamlandı mı?

---

## 🚫 YAPILMAMASI GEREKENLER

1. **API Keys'i commit etme**
2. **node_modules'u commit etme**
3. **Büyük binary files commit etme**
4. **WIP (work in progress) commit yapma**
5. **Test/debug kodlarını production'a alma**
6. **Commented code bırakma (git history var)**
7. **Magic numbers kullanma (constant tanımla)**
8. **Deep nesting (max 3 level)**
9. **God functions (1 function 1 responsibility)**
10. **Global state abuse (local state tercih et)**

---

## 📚 USEFUL RESOURCES

- **Prisma Docs**: https://www.prisma.io/docs
- **Express Best Practices**: https://expressjs.com/en/advanced/best-practice-security.html
- **React Native Performance**: https://reactnative.dev/docs/performance
- **JWT Best Practices**: https://tools.ietf.org/html/rfc8725
- **REST API Design**: https://restfulapi.net/

---

Bu kurallar **tüm geliştirme sürecinde** takip edilmelidir. Şüphe durumunda bu dokümana başvurun.
