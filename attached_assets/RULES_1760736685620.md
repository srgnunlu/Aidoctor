# AI-Doctor GeliÅŸtirme KurallarÄ± ve Best Practices

## ğŸš¨ KRÄ°TÄ°K KURALLAR - ASLA Ä°HLAL ETMEYÄ°N

### 1. Kod Kalitesi
- âŒ **ASLA** `console.log` production kodunda bÄ±rakmayÄ±n
- âŒ **ASLA** hardcoded credentials/secrets kullanmayÄ±n
- âŒ **ASLA** senkron file operations kullanmayÄ±n (async/await kullanÄ±n)
- âœ… **HER ZAMAN** error handling yapÄ±n (try-catch)
- âœ… **HER ZAMAN** input validation yapÄ±n
- âœ… **HER ZAMAN** meaningful variable/function isimleri kullanÄ±n

### 2. GÃ¼venlik
- âŒ **ASLA** ÅŸifreleri plain text saklamayÄ±n (bcrypt kullanÄ±n)
- âŒ **ASLA** SQL queries'i string concatenation ile yapmayÄ±n
- âŒ **ASLA** client'tan gelen veriyi direkt DB'ye yazmayÄ±n
- âœ… **HER ZAMAN** JWT token'larÄ± validate edin
- âœ… **HER ZAMAN** rate limiting uygulayÄ±n
- âœ… **HER ZAMAN** HTTPS kullanÄ±n (production)
- âœ… **HER ZAMAN** CORS ayarlarÄ±nÄ± kontrol edin

### 3. Database
- âŒ **ASLA** sensitive data'yÄ± encrypt etmeden saklamayÄ±n
- âŒ **ASLA** foreign key constraints'leri atlayÄ±n
- âŒ **ASLA** migration'larÄ± manuel dÃ¼zenlemeyin
- âœ… **HER ZAMAN** transactions kullanÄ±n (iliÅŸkili iÅŸlemler iÃ§in)
- âœ… **HER ZAMAN** indexes ekleyin (frequently queried fields)
- âœ… **HER ZAMAN** soft delete kullanÄ±n (hasta verileri iÃ§in)

### 4. API Design
- âŒ **ASLA** sensitive data'yÄ± response'da dÃ¶ndÃ¼rmeyin (ÅŸifre hash vb.)
- âŒ **ASLA** generic error messages dÄ±ÅŸarÄ± vermeyin (security)
- âœ… **HER ZAMAN** RESTful conventions'Ä± takip edin
- âœ… **HER ZAMAN** proper HTTP status codes kullanÄ±n
- âœ… **HER ZAMAN** response format'Ä± consistent tutun
- âœ… **HER ZAMAN** pagination implement edin (list endpoints)

### 5. React Native / Mobile
- âŒ **ASLA** inline styles yazmayÄ±n (StyleSheet kullanÄ±n)
- âŒ **ASLA** index number'larÄ± key prop olarak kullanmayÄ±n
- âŒ **ASLA** memory leak'lere sebep olmayÄ±n (useEffect cleanup)
- âœ… **HER ZAMAN** loading states gÃ¶sterin
- âœ… **HER ZAMAN** error boundaries kullanÄ±n
- âœ… **HER ZAMAN** optimized images kullanÄ±n
- âœ… **HER ZAMAN** keyboard avoiding view kullanÄ±n (forms)

---

## ğŸ“‹ CODING STANDARDS

### JavaScript/Node.js

#### Naming Conventions
```javascript
// âœ… DOÄRU
const patientList = [];
function fetchPatientData() {}
class PatientService {}
const MAX_RETRY_COUNT = 3;

// âŒ YANLIÅ
const pl = [];
function fpd() {}
class patientservice {}
const maxretrycount = 3;
```

#### Function Structure
```javascript
// âœ… DOÄRU - Async/await kullanÄ±mÄ±
async function createPatient(patientData) {
  try {
    // Validation
    if (!patientData.name) {
      throw new Error('Patient name is required');
    }
    
    // Business logic
    const patient = await db.patient.create({
      data: patientData
    });
    
    return { success: true, data: patient };
  } catch (error) {
    console.error('Error creating patient:', error);
    throw error; // Re-throw for controller to handle
  }
}

// âŒ YANLIÅ - Callback hell, error handling yok
function createPatient(patientData, callback) {
  db.patient.create(patientData, function(err, patient) {
    if (err) callback(err);
    callback(null, patient);
  });
}
```

#### Error Handling Pattern
```javascript
// âœ… DOÄRU - Consistent error response
const errorResponse = (res, statusCode, message, error = null) => {
  return res.status(statusCode).json({
    success: false,
    message,
    error: process.env.NODE_ENV === 'development' ? error : undefined
  });
};

// Controller usage
try {
  const result = await patientService.getPatient(id);
  return res.json({ success: true, data: result });
} catch (error) {
  return errorResponse(res, 500, 'Failed to fetch patient', error.message);
}
```

### React Native

#### Component Structure
```javascript
// âœ… DOÄRU - Functional component with hooks
import React, { useState, useEffect } from 'react';
import { View, Text, StyleSheet, ActivityIndicator } from 'react-native';

const PatientCard = ({ patient, onPress }) => {
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    // Cleanup function
    return () => {
      // Cleanup code here
    };
  }, []);
  
  if (loading) {
    return <ActivityIndicator />;
  }
  
  return (
    <View style={styles.container}>
      <Text style={styles.name}>{patient.name}</Text>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    padding: 16,
    backgroundColor: '#fff',
  },
  name: {
    fontSize: 18,
    fontWeight: 'bold',
  },
});

export default PatientCard;
```

#### Redux Pattern
```javascript
// âœ… DOÄRU - Redux Toolkit slice
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

export const fetchPatients = createAsyncThunk(
  'patients/fetchAll',
  async (_, { rejectWithValue }) => {
    try {
      const response = await api.get('/patients');
      return response.data;
    } catch (error) {
      return rejectWithValue(error.response.data);
    }
  }
);

const patientSlice = createSlice({
  name: 'patients',
  initialState: {
    list: [],
    loading: false,
    error: null,
  },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchPatients.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchPatients.fulfilled, (state, action) => {
        state.loading = false;
        state.list = action.payload;
      })
      .addCase(fetchPatients.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      });
  },
});

export default patientSlice.reducer;
```

---

## ğŸ—‚ï¸ FILE ORGANIZATION

### Backend File Naming
```
âœ… DOÄRU
controllers/patientController.js
services/patientService.js
models/Patient.js
routes/patientRoutes.js
middleware/authMiddleware.js
utils/dateHelper.js
validators/patientValidator.js

âŒ YANLIÅ
controllers/patients.js
services/patient-service.js
models/patient.js
routes/Patients.js
```

### Frontend File Naming
```
âœ… DOÄRU
screens/PatientListScreen.js
components/PatientCard.js
navigation/AppNavigator.js
services/apiService.js
constants/colors.js
hooks/usePatients.js

âŒ YANLIÅ
screens/patientlist.js
components/patient-card.js
navigation/app-navigator.js
```

---

## ğŸ”’ SECURITY CHECKLIST

### Her Endpoint Ä°Ã§in
- [ ] Authentication middleware var mÄ±?
- [ ] Input validation yapÄ±lÄ±yor mu?
- [ ] Rate limiting var mÄ±?
- [ ] User authorization check ediliyor mu? (baÅŸkasÄ±nÄ±n hastasÄ±na eriÅŸemiyor mu?)
- [ ] Sensitive data filter ediliyor mu?

### Her Form Ä°Ã§in
- [ ] Client-side validation var mÄ±?
- [ ] Server-side validation var mÄ±?
- [ ] XSS protection var mÄ±?
- [ ] SQL injection korumalÄ± mÄ±?
- [ ] File upload size limit var mÄ±?

---

## ğŸ“ COMMIT MESSAGE CONVENTIONS

```
feat: Add patient list screen
fix: Fix authentication token expiry
refactor: Refactor patient service
docs: Update API documentation
style: Format code with prettier
test: Add patient controller tests
chore: Update dependencies
```

**Commit Structure:**
```
<type>: <subject>

<body> (optional)

<footer> (optional)
```

---

## ğŸ§ª TESTING REQUIREMENTS

### Backend Test Ã–rneÄŸi
```javascript
// tests/controllers/patientController.test.js
describe('Patient Controller', () => {
  describe('GET /api/patients', () => {
    it('should return patient list for authenticated user', async () => {
      const token = generateTestToken();
      const response = await request(app)
        .get('/api/patients')
        .set('Authorization', `Bearer ${token}`)
        .expect(200);
        
      expect(response.body.success).toBe(true);
      expect(Array.isArray(response.body.data)).toBe(true);
    });
    
    it('should return 401 for unauthenticated request', async () => {
      await request(app)
        .get('/api/patients')
        .expect(401);
    });
  });
});
```

### Frontend Test Ã–rneÄŸi
```javascript
// __tests__/PatientCard.test.js
import { render, fireEvent } from '@testing-library/react-native';
import PatientCard from '../components/PatientCard';

describe('PatientCard', () => {
  const mockPatient = {
    id: '1',
    name: 'Test Patient',
    age: 30,
  };
  
  it('renders patient name correctly', () => {
    const { getByText } = render(<PatientCard patient={mockPatient} />);
    expect(getByText('Test Patient')).toBeTruthy();
  });
  
  it('calls onPress when pressed', () => {
    const onPressMock = jest.fn();
    const { getByText } = render(
      <PatientCard patient={mockPatient} onPress={onPressMock} />
    );
    
    fireEvent.press(getByText('Test Patient'));
    expect(onPressMock).toHaveBeenCalledWith(mockPatient);
  });
});
```

---

## ğŸš€ PERFORMANCE BEST PRACTICES

### Backend
```javascript
// âœ… DOÄRU - Eager loading ile N+1 problem'i Ã§Ã¶z
const patients = await prisma.patient.findMany({
  where: { userId: userId },
  include: {
    vitalSigns: true,
    labResults: true,
  },
});

// âŒ YANLIÅ - N+1 query problem
const patients = await prisma.patient.findMany({ where: { userId } });
for (const patient of patients) {
  patient.vitals = await prisma.vitalSigns.findMany({ 
    where: { patientId: patient.id } 
  });
}
```

### Frontend
```javascript
// âœ… DOÄRU - FlatList for long lists
<FlatList
  data={patients}
  renderItem={({ item }) => <PatientCard patient={item} />}
  keyExtractor={(item) => item.id}
  removeClippedSubviews={true}
  maxToRenderPerBatch={10}
  windowSize={21}
/>

// âŒ YANLIÅ - ScrollView with map (poor performance)
<ScrollView>
  {patients.map(patient => (
    <PatientCard key={patient.id} patient={patient} />
  ))}
</ScrollView>

// âœ… DOÄRU - useMemo for expensive calculations
const sortedPatients = useMemo(() => {
  return patients.sort((a, b) => 
    new Date(b.admissionTime) - new Date(a.admissionTime)
  );
}, [patients]);

// âœ… DOÄRU - useCallback for function props
const handlePatientPress = useCallback((patient) => {
  navigation.navigate('PatientDetail', { patientId: patient.id });
}, [navigation]);
```

---

## ğŸ“± RESPONSIVE DESIGN

```javascript
// âœ… DOÄRU - Dimensions API kullanÄ±mÄ±
import { Dimensions } from 'react-native';

const { width, height } = Dimensions.get('window');

const styles = StyleSheet.create({
  container: {
    width: width * 0.9,
    padding: width > 768 ? 24 : 16, // Tablet vs phone
  },
});
```

---

## ğŸŒ API INTEGRATION PATTERN

```javascript
// services/apiService.js
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';

const api = axios.create({
  baseURL: process.env.API_BASE_URL,
  timeout: 10000,
});

// Request interceptor - Add auth token
api.interceptors.request.use(
  async (config) => {
    const token = await AsyncStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor - Handle errors
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Token expired, try refresh
      // If refresh fails, logout user
    }
    return Promise.reject(error);
  }
);

export default api;
```

---

## ğŸ¨ UI/UX GUIDELINES

### Loading States
```javascript
// âœ… HER ZAMAN loading state gÃ¶ster
{loading ? (
  <ActivityIndicator size="large" color="#0000ff" />
) : (
  <PatientList data={patients} />
)}
```

### Error States
```javascript
// âœ… HER ZAMAN user-friendly error messages
{error && (
  <View style={styles.errorContainer}>
    <Text style={styles.errorText}>
      {error.message || 'Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.'}
    </Text>
    <Button title="Tekrar Dene" onPress={handleRetry} />
  </View>
)}
```

### Empty States
```javascript
// âœ… HER ZAMAN empty state gÃ¶ster
{patients.length === 0 && !loading && (
  <View style={styles.emptyContainer}>
    <Text style={styles.emptyText}>HenÃ¼z hasta eklenmemiÅŸ</Text>
    <Button title="Ä°lk HastayÄ± Ekle" onPress={handleAddPatient} />
  </View>
)}
```

---

## ğŸ” DEBUGGING TIPS

### Backend
```javascript
// Development ortamÄ±nda detaylÄ± log
if (process.env.NODE_ENV === 'development') {
  console.log('Request Body:', req.body);
  console.log('User ID:', req.user.id);
}

// Production'da structured logging
logger.info('Patient created', {
  userId: req.user.id,
  patientId: patient.id,
  timestamp: new Date().toISOString(),
});
```

### Frontend
```javascript
// React Native Debugger kullan
// console.log yerine alert veya Toast kullan (gÃ¶rsel debug)
```

---

## âœ… PRE-COMMIT CHECKLIST

Her commit Ã¶ncesi kontrol edin:
- [ ] Kod Ã§alÄ±ÅŸÄ±yor mu? (test ettim)
- [ ] Testler geÃ§iyor mu?
- [ ] Console.log'lar temizlendi mi?
- [ ] Error handling var mÄ±?
- [ ] Hardcoded value yok mu?
- [ ] Comments gereksizleri temizlendi mi?
- [ ] Naming conventions doÄŸru mu?
- [ ] Security checklist tamamlandÄ± mÄ±?

---

## ğŸš« YAPILMAMASI GEREKENLER

1. **API Keys'i commit etme**
2. **node_modules'u commit etme**
3. **BÃ¼yÃ¼k binary files commit etme**
4. **WIP (work in progress) commit yapma**
5. **Test/debug kodlarÄ±nÄ± production'a alma**
6. **Commented code bÄ±rakma (git history var)**
7. **Magic numbers kullanma (constant tanÄ±mla)**
8. **Deep nesting (max 3 level)**
9. **God functions (1 function 1 responsibility)**
10. **Global state abuse (local state tercih et)**

---

## ğŸ“š USEFUL RESOURCES

- **Prisma Docs**: https://www.prisma.io/docs
- **Express Best Practices**: https://expressjs.com/en/advanced/best-practice-security.html
- **React Native Performance**: https://reactnative.dev/docs/performance
- **JWT Best Practices**: https://tools.ietf.org/html/rfc8725
- **REST API Design**: https://restfulapi.net/

---

Bu kurallar **tÃ¼m geliÅŸtirme sÃ¼recinde** takip edilmelidir. ÅÃ¼phe durumunda bu dokÃ¼mana baÅŸvurun.
